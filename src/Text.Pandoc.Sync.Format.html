<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DeriveGeneric        #-}</span><span>
</span><a name="line-2"></a><span class="hs-pragma">{-# LANGUAGE FlexibleInstances    #-}</span><span>
</span><a name="line-3"></a><span class="hs-pragma">{-# LANGUAGE GADTs                #-}</span><span>
</span><a name="line-4"></a><span class="hs-pragma">{-# LANGUAGE InstanceSigs         #-}</span><span>
</span><a name="line-5"></a><span class="hs-pragma">{-# LANGUAGE KindSignatures       #-}</span><span>
</span><a name="line-6"></a><span class="hs-pragma">{-# LANGUAGE LambdaCase           #-}</span><span>
</span><a name="line-7"></a><span class="hs-pragma">{-# LANGUAGE OverloadedStrings    #-}</span><span>
</span><a name="line-8"></a><span class="hs-pragma">{-# LANGUAGE RankNTypes           #-}</span><span>
</span><a name="line-9"></a><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables  #-}</span><span>
</span><a name="line-10"></a><span class="hs-pragma">{-# LANGUAGE StandaloneDeriving   #-}</span><span>
</span><a name="line-11"></a><span class="hs-pragma">{-# LANGUAGE TemplateHaskell      #-}</span><span>
</span><a name="line-12"></a><span class="hs-pragma">{-# LANGUAGE TypeApplications     #-}</span><span>
</span><a name="line-13"></a><span class="hs-pragma">{-# LANGUAGE TypeInType           #-}</span><span>
</span><a name="line-14"></a><span class="hs-pragma">{-# OPTIONS_GHC -fno-warn-orphans #-}</span><span>
</span><a name="line-15"></a><span>
</span><a name="line-16"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Text</span><span class="hs-operator">.</span><span class="hs-identifier">Pandoc</span><span class="hs-operator">.</span><span class="hs-identifier">Sync</span><span class="hs-operator">.</span><span class="hs-identifier">Format</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-17"></a><span>    </span><a href="Text.Pandoc.Sync.Format.html#MarkdownType"><span class="hs-identifier hs-type">MarkdownType</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-18"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Text.Pandoc.Sync.Format.html#SlideShowType"><span class="hs-identifier hs-type">SlideShowType</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Text.Pandoc.Sync.Format.html#AsSlideShowType"><span class="hs-identifier hs-type">AsSlideShowType</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-19"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Text.Pandoc.Sync.Format.html#PDFType"><span class="hs-identifier hs-type">PDFType</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-20"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Text.Pandoc.Sync.Format.html#Format"><span class="hs-identifier hs-type">Format</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Text.Pandoc.Sync.Format.html#AsFormat"><span class="hs-identifier hs-type">AsFormat</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-21"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Text.Pandoc.Sync.Format.html#SomeFormat"><span class="hs-identifier hs-type">SomeFormat</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Text.Pandoc.Sync.Format.html#someFormat"><span class="hs-identifier hs-var">someFormat</span></a><span>
</span><a name="line-22"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Text.Pandoc.Sync.Format.html#asReader"><span class="hs-identifier hs-var">asReader</span></a><span>
</span><a name="line-23"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Text.Pandoc.Sync.Format.html#writeOnly"><span class="hs-identifier hs-var">writeOnly</span></a><span>
</span><a name="line-24"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Text.Pandoc.Sync.Format.html#Writer"><span class="hs-identifier hs-type">Writer</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-25"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Text.Pandoc.Sync.Format.html#ReaderOptions"><span class="hs-identifier hs-type">ReaderOptions</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-26"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Text.Pandoc.Sync.Format.html#fromReaderOptions"><span class="hs-identifier hs-var">fromReaderOptions</span></a><span>
</span><a name="line-27"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Text.Pandoc.Sync.Format.html#WriterOptions"><span class="hs-identifier hs-type">WriterOptions</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Text.Pandoc.Sync.Format.html#HasWriterOptions"><span class="hs-identifier hs-type">HasWriterOptions</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-28"></a><span>  </span><span class="hs-comment">-- , writerOptions</span><span>
</span><a name="line-29"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Text.Pandoc.Sync.Format.html#formatReader"><span class="hs-identifier hs-var">formatReader</span></a><span>
</span><a name="line-30"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Text.Pandoc.Sync.Format.html#formatWriter"><span class="hs-identifier hs-var">formatWriter</span></a><span>
</span><a name="line-31"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Text.Pandoc.Sync.Format.html#FormatOptions"><span class="hs-identifier hs-type">FormatOptions</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-32"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Text.Pandoc.Sync.Format.html#foFormat"><span class="hs-identifier hs-var">foFormat</span></a><span>
</span><a name="line-33"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Text.Pandoc.Sync.Format.html#pdfFormat"><span class="hs-identifier hs-var">pdfFormat</span></a><span>
</span><a name="line-34"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Text.Pandoc.Sync.Format.html#foWriterOpts"><span class="hs-identifier hs-var">foWriterOpts</span></a><span>
</span><a name="line-35"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Text.Pandoc.Sync.Format.html#foReaderOpts"><span class="hs-identifier hs-var">foReaderOpts</span></a><span>
</span><a name="line-36"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Text.Pandoc.Sync.Format.html#readerString"><span class="hs-identifier hs-var">readerString</span></a><span>
</span><a name="line-37"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Text.Pandoc.Sync.Format.html#writerString"><span class="hs-identifier hs-var">writerString</span></a><span>
</span><a name="line-38"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Text.Pandoc.Sync.Format.html#HasIf"><span class="hs-identifier hs-type">HasIf</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-39"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Text.Pandoc.Sync.Format.html#_Has"><span class="hs-identifier hs-var">_Has</span></a><span>
</span><a name="line-40"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Text.Pandoc.Sync.Format.html#_Hasn%27t"><span class="hs-identifier hs-var">_Hasn't</span></a><span>
</span><a name="line-41"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Text.Pandoc.Sync.Format.html#hasIfMaybe"><span class="hs-identifier hs-var">hasIfMaybe</span></a><span>
</span><a name="line-42"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Text.Pandoc.Sync.Format.html#allFormats"><span class="hs-identifier hs-var">allFormats</span></a><span>
</span><a name="line-43"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Text.Pandoc.Sync.Format.html#allWriters"><span class="hs-identifier hs-var">allWriters</span></a><span>
</span><a name="line-44"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Text.Pandoc.Sync.Format.html#inferWriter"><span class="hs-identifier hs-var">inferWriter</span></a><span>
</span><a name="line-45"></a><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-46"></a><span>
</span><a name="line-47"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Applicative</span><span>
</span><a name="line-48"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Lens</span><span> </span><span class="hs-keyword">hiding</span><span>          </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-operator hs-var">.=</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-49"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Aeson</span><span>
</span><a name="line-50"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Aeson</span><span class="hs-operator">.</span><span class="hs-identifier">Lens</span><span>
</span><a name="line-51"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Char</span><span>
</span><a name="line-52"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Default</span><span>
</span><a name="line-53"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Foldable</span><span>
</span><a name="line-54"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Hashable</span><span>
</span><a name="line-55"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Kind</span><span>
</span><a name="line-56"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Maybe</span><span>
</span><a name="line-57"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Monoid</span><span>
</span><a name="line-58"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Singletons</span><span>
</span><a name="line-59"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Singletons</span><span class="hs-operator">.</span><span class="hs-identifier">Prelude</span><span class="hs-operator">.</span><span class="hs-identifier">Bool</span><span>
</span><a name="line-60"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Type</span><span class="hs-operator">.</span><span class="hs-identifier">Equality</span><span>
</span><a name="line-61"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">GHC</span><span class="hs-operator">.</span><span class="hs-identifier">Generics</span><span>                 </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Generic</span><span class="hs-special">)</span><span>
</span><a name="line-62"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Text</span><span class="hs-operator">.</span><span class="hs-identifier">Printf</span><span>
</span><a name="line-63"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Binary</span><span>                  </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Bi</span><span>
</span><a name="line-64"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">IntMap</span><span>                  </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">IM</span><span>
</span><a name="line-65"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Map</span><span>                     </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">M</span><span>
</span><a name="line-66"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Singletons</span><span class="hs-operator">.</span><span class="hs-identifier">Decide</span><span>       </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Si</span><span>
</span><a name="line-67"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Text</span><span>                    </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">T</span><span>
</span><a name="line-68"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Text</span><span class="hs-operator">.</span><span class="hs-identifier">Megaparsec</span><span>              </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">MP</span><span>
</span><a name="line-69"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Text</span><span class="hs-operator">.</span><span class="hs-identifier">Megaparsec</span><span class="hs-operator">.</span><span class="hs-identifier">Lexer</span><span>        </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">MPL</span><span>
</span><a name="line-70"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Text</span><span class="hs-operator">.</span><span class="hs-identifier">Megaparsec</span><span class="hs-operator">.</span><span class="hs-identifier">Text</span><span>         </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">MP</span><span>
</span><a name="line-71"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Text</span><span class="hs-operator">.</span><span class="hs-identifier">Pandoc</span><span>                  </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">P</span><span>
</span><a name="line-72"></a><span>
</span><a name="line-73"></a><span class="hs-keyword">data</span><span> </span><a name="MarkdownType"><a href="Text.Pandoc.Sync.Format.html#MarkdownType"><span class="hs-identifier">MarkdownType</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="MDPandoc"><a href="Text.Pandoc.Sync.Format.html#MDPandoc"><span class="hs-identifier">MDPandoc</span></a></a><span>
</span><a name="line-74"></a><span>                  </span><span class="hs-glyph">|</span><span> </span><a name="MDStrict"><a href="Text.Pandoc.Sync.Format.html#MDStrict"><span class="hs-identifier">MDStrict</span></a></a><span>
</span><a name="line-75"></a><span>                  </span><span class="hs-glyph">|</span><span> </span><a name="MDPHP"><a href="Text.Pandoc.Sync.Format.html#MDPHP"><span class="hs-identifier">MDPHP</span></a></a><span>
</span><a name="line-76"></a><span>                  </span><span class="hs-glyph">|</span><span> </span><a name="MDGithub"><a href="Text.Pandoc.Sync.Format.html#MDGithub"><span class="hs-identifier">MDGithub</span></a></a><span>
</span><a name="line-77"></a><span>                  </span><span class="hs-glyph">|</span><span> </span><a name="MDMulti"><a href="Text.Pandoc.Sync.Format.html#MDMulti"><span class="hs-identifier">MDMulti</span></a></a><span>
</span><a name="line-78"></a><span>                  </span><span class="hs-glyph">|</span><span> </span><a name="MDCommon"><a href="Text.Pandoc.Sync.Format.html#MDCommon"><span class="hs-identifier">MDCommon</span></a></a><span>
</span><a name="line-79"></a><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Show</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Generic</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Enum</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Bounded</span><span class="hs-special">)</span><span>
</span><a name="line-80"></a><span>
</span><a name="line-81"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Bi</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">Binary</span><span> </span><a href="Text.Pandoc.Sync.Format.html#MarkdownType"><span class="hs-identifier hs-type">MarkdownType</span></a><span>
</span><a name="line-82"></a><span>
</span><a name="line-83"></a><span class="hs-keyword">data</span><span> </span><a name="SlideShowType"><a href="Text.Pandoc.Sync.Format.html#SlideShowType"><span class="hs-identifier">SlideShowType</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="SSS5"><a href="Text.Pandoc.Sync.Format.html#SSS5"><span class="hs-identifier">SSS5</span></a></a><span>
</span><a name="line-84"></a><span>                   </span><span class="hs-glyph">|</span><span> </span><a name="SSSlidy"><a href="Text.Pandoc.Sync.Format.html#SSSlidy"><span class="hs-identifier">SSSlidy</span></a></a><span>
</span><a name="line-85"></a><span>                   </span><span class="hs-glyph">|</span><span> </span><a name="SSSlideous"><a href="Text.Pandoc.Sync.Format.html#SSSlideous"><span class="hs-identifier">SSSlideous</span></a></a><span>
</span><a name="line-86"></a><span>                   </span><span class="hs-glyph">|</span><span> </span><a name="SSDZSlides"><a href="Text.Pandoc.Sync.Format.html#SSDZSlides"><span class="hs-identifier">SSDZSlides</span></a></a><span>
</span><a name="line-87"></a><span>                   </span><span class="hs-glyph">|</span><span> </span><a name="SSRevealJS"><a href="Text.Pandoc.Sync.Format.html#SSRevealJS"><span class="hs-identifier">SSRevealJS</span></a></a><span>
</span><a name="line-88"></a><span>                   </span><span class="hs-glyph">|</span><span> </span><a name="SSBeamer"><a href="Text.Pandoc.Sync.Format.html#SSBeamer"><span class="hs-identifier">SSBeamer</span></a></a><span>
</span><a name="line-89"></a><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Show</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Generic</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Enum</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Bounded</span><span class="hs-special">)</span><span>
</span><a name="line-90"></a><span>
</span><a name="line-91"></a><span class="hs-identifier hs-var">makeClassyPrisms</span><span> </span><span class="hs-char">''SlideShowType

instance Bi.Binary SlideShowType

data PDFType = PTLaTeX
             | PTBeamer
             | PTConTeXt
             | PTHTML5
  deriving (Show, Generic, Eq, Ord, Enum, Bounded)

instance Bi.Binary PDFType

data Format :: Bool -&gt; Bool -&gt; Type where
    FNative       :: Format 'True  'True
    FJSON         :: Format 'True  'True
    FMarkdown     :: MarkdownType
                  -&gt; Bool           -- LHS
                  -&gt; Format 'True  'True
    FRST          :: Format 'True  'True
    FMediaWiki    :: Format 'True  'True
    FDocBook      :: Bool
                  -&gt; Format 'True  'True
    FOPML         :: Format 'True  'True
    FOrg          :: Format 'True  'True
    FTextile      :: Format 'True  'True
    FHTML         :: Bool
                  -&gt; Format 'True  'True
    FLaTeX        :: Format 'True  'True
    FHaddock      :: Format 'True  'True
    FTWiki        :: Format 'True  'False
    FDocX         :: Format 'True  'True
    FODT          :: Format 'True  'True
    FT2T          :: Format 'True  'False
    FEPub         :: P.EPUBVersion
                  -&gt; Format 'True  'True
    FFictionBook2 :: Format 'False 'True
    FICML         :: Format 'False 'True
    FSlideShow    :: SlideShowType
                  -&gt; Format 'False 'True
    FOpenDocument :: Format 'False 'True
    FConTeXt      :: Format 'False 'True
    FTexinfo      :: Format 'False 'True
    FMan          :: Format 'False 'True
    FPlain        :: Format 'False 'True
    FDokuWiki     :: Format 'False 'True
    FZimWiki      :: Format 'False 'True
    FASCIIDoc     :: Format 'False 'True
    FTEI          :: Format 'False 'True
    FPDF          :: PDFType
                  -&gt; Format 'False 'True
    FRTF          :: Format 'False 'True
    FMkWriteOnly  :: Format 'True  'True
                  -&gt; Format 'False 'True
    FMkReadOnly   :: Format 'True  'True
                  -&gt; Format 'True  'False

deriving instance Show (Format r w)

instance (SingI r, SingI w) =&gt; Bi.Binary (Format r w) where
    get = do
      SomeFormat r w ft &lt;- Bi.get
      Si.Proved Refl &lt;- return $ r Si.%~ (sing @_ @r)
      Si.Proved Refl &lt;- return $ w Si.%~ (sing @_ @w)
      return ft
    put = Bi.put . someFormat

instance (SingI r, SingI w) =&gt; Hashable (Format r w) where
    hashWithSalt s fm = s `hashWithSalt` Bi.encode fm

class AsFormat ft where
    _FHTML      :: Prism' (ft 'True  'True) Bool
    _FSlideShow :: Prism' (ft 'False 'True) SlideShowType
    _FPDF       :: Prism' (ft 'False 'True) PDFType
    _FODT       :: Prism' (ft 'True  'True) ()
    _FDocX      :: Prism' (ft 'True  'True) ()

instance AsFormat Format where
    _FHTML = prism FHTML (\case FHTML t -&gt; Right t
                                ft      -&gt; Left ft
                         )
    _FSlideShow = prism FSlideShow (\case FSlideShow t -&gt; Right t
                                          ft           -&gt; Left ft
                                   )
    _FPDF = prism FPDF (\case FPDF t -&gt; Right t
                              ft     -&gt; Left ft
                       )
    _FODT = prism (const FODT) (\case FODT -&gt; Right ()
                                      ft   -&gt; Left ft
                               )
    _FDocX = prism (const FDocX) (\case FDocX -&gt; Right ()
                                        ft    -&gt; Left ft
                                 )

asReader :: forall r' r w. SingI r' =&gt; Sing r -&gt; Traversal' (Format r' w) (Format r w)
asReader sr f = case sing @_ @r' Si.%~ sr of
    Si.Proved Refl -&gt; f
    Si.Disproved _ -&gt; pure

writeOnly :: forall r. SingI r =&gt; Format r 'True -&gt; Format 'False 'True
writeOnly = case sing @_ @r of
    SFalse -&gt; id
    STrue  -&gt; FMkWriteOnly

data Writer :: (Bool -&gt; Bool -&gt; Type) -&gt; Type where
    Writer :: SingI r =&gt; f r 'True -&gt; Writer f

instance Show (Writer Format) where
    showsPrec d (Writer ft) = showParen (d &gt; app_prec) $
        showString &quot;Writer &quot; . showsPrec (app_prec + 1) ft
      where
        app_prec = 10

data SomeFormat :: Type where
    SomeFormat :: Sing r -&gt; Sing w -&gt; Format r w -&gt; SomeFormat

someFormat :: (SingI r, SingI w) =&gt; Format r w -&gt; SomeFormat
someFormat = SomeFormat sing sing

instance Show SomeFormat where
    showsPrec d (SomeFormat _ _ ft) = showParen (d &gt; app_prec) $
        showString &quot;SomeFormat &quot; . showsPrec (app_prec + 1) ft
      where
        app_prec = 10

instance Bi.Binary P.EPUBVersion

instance Bi.Binary SomeFormat where
    get = do
        i &lt;- Bi.get
        fromMaybe (error &quot;Corrupted SomeFormat&quot;) $ IM.lookup i ftmap
      where
        ftmap = IM.fromList [(0, return $ someFormat FNative          )
                            ,(1, return $ someFormat FJSON            )
                            ,(2, someFormat &lt;$&gt; (FMarkdown &lt;$&gt; Bi.get &lt;*&gt; Bi.get))
                            ,(3, return $ someFormat FRST             )
                            ,(4, return $ someFormat FMediaWiki       )
                            ,(5, someFormat . FDocBook &lt;$&gt; Bi.get     )
                            ,(6, return $ someFormat FOPML            )
                            ,(7, return $ someFormat FOrg             )
                            ,(8, return $ someFormat FTextile         )
                            ,(9, someFormat . FHTML &lt;$&gt; Bi.get        )
                            ,(10, return $ someFormat FLaTeX          )
                            ,(11, return $ someFormat FHaddock        )
                            ,(12, return $ someFormat FTWiki          )
                            ,(13, return $ someFormat FDocX           )
                            ,(14, return $ someFormat FODT            )
                            ,(15, return $ someFormat FT2T            )
                            ,(16, someFormat . FEPub &lt;$&gt; Bi.get       )
                            ,(17, return $ someFormat FFictionBook2   )
                            ,(18, return $ someFormat FICML           )
                            ,(19, someFormat . FSlideShow &lt;$&gt; Bi.get  )
                            ,(20, return $ someFormat FOpenDocument   )
                            ,(21, return $ someFormat FConTeXt        )
                            ,(22, return $ someFormat FTexinfo        )
                            ,(23, return $ someFormat FMan            )
                            ,(24, return $ someFormat FPlain          )
                            ,(25, return $ someFormat FDokuWiki       )
                            ,(26, return $ someFormat FASCIIDoc       )
                            ,(27, return $ someFormat FTEI            )
                            ,(28, someFormat . FPDF &lt;$&gt; Bi.get        )
                            ,(29, return $ someFormat FZimWiki        )
                            ,(30, return $ someFormat FRTF            )
                            ,(31, someFormat . FMkWriteOnly &lt;$&gt; Bi.get)
                            ,(32, someFormat . FMkReadOnly &lt;$&gt; Bi.get )
                            ]
    put (SomeFormat _ _ ft) = case ft of
      FNative        -&gt; Bi.put @Int 0
      FJSON          -&gt; Bi.put @Int 1
      FMarkdown mt l -&gt; Bi.put @Int 2 *&gt; Bi.put mt *&gt; Bi.put l
      FRST           -&gt; Bi.put @Int 3
      FMediaWiki     -&gt; Bi.put @Int 4
      FDocBook v     -&gt; Bi.put @Int 5 *&gt; Bi.put v
      FOPML          -&gt; Bi.put @Int 6
      FOrg           -&gt; Bi.put @Int 7
      FTextile       -&gt; Bi.put @Int 8
      FHTML five     -&gt; Bi.put @Int 9 *&gt; Bi.put five
      FLaTeX         -&gt; Bi.put @Int 10
      FHaddock       -&gt; Bi.put @Int 11
      FTWiki         -&gt; Bi.put @Int 12
      FDocX          -&gt; Bi.put @Int 13
      FODT           -&gt; Bi.put @Int 14
      FT2T           -&gt; Bi.put @Int 15
      FEPub v        -&gt; Bi.put @Int 16 *&gt; Bi.put v
      FFictionBook2  -&gt; Bi.put @Int 17
      FICML          -&gt; Bi.put @Int 18
      FSlideShow t   -&gt; Bi.put @Int 19 *&gt; Bi.put t
      FOpenDocument  -&gt; Bi.put @Int 20
      FConTeXt       -&gt; Bi.put @Int 21
      FTexinfo       -&gt; Bi.put @Int 22
      FMan           -&gt; Bi.put @Int 23
      FPlain         -&gt; Bi.put @Int 24
      FDokuWiki      -&gt; Bi.put @Int 25
      FASCIIDoc      -&gt; Bi.put @Int 26
      FTEI           -&gt; Bi.put @Int 27
      FPDF t         -&gt; Bi.put @Int 28 *&gt; Bi.put t
      FZimWiki       -&gt; Bi.put @Int 29
      FRTF           -&gt; Bi.put @Int 30
      FMkWriteOnly f -&gt; Bi.put @Int 31 *&gt; Bi.put f
      FMkReadOnly f  -&gt; Bi.put @Int 32 *&gt; Bi.put f

instance Hashable SomeFormat where
    hashWithSalt s (SomeFormat sr sw ft) = withSingI sr $
                                           withSingI sw $
      hashWithSalt s ft

data HasIf :: Bool -&gt; Type -&gt; Type where
    Has    :: a -&gt; HasIf 'True a
    Hasn't :: HasIf 'False a

deriving instance Eq a   =&gt; Eq (HasIf b a)
deriving instance Show a =&gt; Show (HasIf b a)

_Has :: Iso' (HasIf 'True a) a
_Has = iso (\case Has x -&gt; x) Has

_Hasn't :: Iso' (HasIf 'False a) ()
_Hasn't = iso (const ()) (const Hasn't)

hasIfMaybe :: HasIf b a -&gt; Maybe a
hasIfMaybe = \case
    Has  x -&gt; Just x
    Hasn't -&gt; Nothing

_HasIf :: forall r a b. SingI r =&gt; Prism (HasIf r a) (HasIf r b) a b
_HasIf = prism (case sing @_ @r of
                  STrue -&gt; Has
                  SFalse -&gt; const Hasn't
               )
               (\case Has x -&gt; Right x; Hasn't -&gt; Left Hasn't)

instance (SingI b, Bi.Binary a) =&gt; Bi.Binary (HasIf b a) where
    get = case sing @_ @b of
      STrue  -&gt; Has &lt;$&gt; Bi.get
      SFalse -&gt; return Hasn't
    put = \case
      Has x  -&gt; Bi.put x
      Hasn't -&gt; return ()

instance (SingI b, Default a) =&gt; Default (HasIf b a) where
    def = case sing @_ @b of
      STrue  -&gt; Has def
      SFalse -&gt; Hasn't

instance Hashable a =&gt; Hashable (HasIf b a) where
    hashWithSalt s = \case
      Has x  -&gt; s `hashWithSalt` (0 :: Int)
                  `hashWithSalt` x
      Hasn't -&gt; s `hashWithSalt` (1 :: Int)

instance (SingI b, FromJSON a) =&gt; FromJSON (HasIf b a) where
    parseJSON = case sing @_ @b of
      STrue  -&gt; fmap Has . parseJSON
      SFalse -&gt; const $ pure Hasn't

data ReaderOptions = RO
    deriving (Show, Eq, Ord, Generic)

deriving instance Ord P.HTMLMathMethod
instance Bi.Binary P.HTMLMathMethod
instance Hashable P.HTMLMathMethod

data WriterOptions = WO { _woStandalone    :: Bool
                        , _woTemplatePath  :: Maybe FilePath
                        , _woDataDir       :: Maybe FilePath
                        , _woMathMethod    :: P.HTMLMathMethod
                        , _woVariables     :: M.Map String String
                        , _woTabStop       :: Int
                        , _woTOC           :: Bool
                        , _woReferenceODT  :: Maybe FilePath
                        , _woReferenceDocX :: Maybe FilePath
                        }
    deriving (Show, Eq, Ord, Generic)

makeClassy ''WriterOptions

instance Bi.Binary ReaderOptions
instance Bi.Binary WriterOptions

instance Default ReaderOptions where
    def = RO

instance Default WriterOptions where
    def = WO True Nothing Nothing P.PlainMath M.empty 4 False Nothing Nothing

instance Hashable ReaderOptions
instance Hashable WriterOptions where
    hashWithSalt s wo = s `hashWithSalt` wo ^. woStandalone
                          `hashWithSalt` wo ^. woTemplatePath
                          `hashWithSalt` wo ^. woDataDir
                          `hashWithSalt` M.toList (wo ^. woVariables)
                          `hashWithSalt` wo ^. woTabStop
                          `hashWithSalt` wo ^. woTOC
                          `hashWithSalt` wo ^. woReferenceODT
                          `hashWithSalt` wo ^. woReferenceDocX

instance FromJSON ReaderOptions
instance FromJSON WriterOptions where
    parseJSON = withObject &quot;WriterOptions&quot; $ \v -&gt;
      WO &lt;$&gt; (fromMaybe True    &lt;$&gt; v .:? &quot;standalone&quot;)
         &lt;*&gt; (v .:? &quot;template-path&quot;)
         &lt;*&gt; (v .:? &quot;data-dir&quot;)
         &lt;*&gt; pure P.PlainMath
         &lt;*&gt; (fromMaybe M.empty &lt;$&gt; v .:? &quot;variables&quot;)
         &lt;*&gt; (fromMaybe 4 &lt;$&gt; v .: &quot;tab-stop&quot;)
         &lt;*&gt; (fromMaybe False &lt;$&gt; (v .: &quot;toc&quot; &lt;|&gt; v .: &quot;table-of-contents&quot;))
         &lt;*&gt; (v .:? &quot;reference-odt&quot;)
         &lt;*&gt; (v .:? &quot;reference-docx&quot;)

instance ToJSON ReaderOptions
instance ToJSON WriterOptions where
    toJSON wo = object $ mconcat
      [ ifNotDef &quot;standalone&quot;        True    (wo ^. woStandalone)
      , [ &quot;template-path&quot; .= (wo ^. woTemplatePath) ]
      , [ &quot;data-dir&quot;      .= (wo ^. woDataDir)      ]
      , ifNotDef &quot;variables&quot;         M.empty (wo ^. woVariables)
      , ifNotDef &quot;tab-stop&quot;          4       (wo ^. woTabStop)
      , ifNotDef &quot;table-of-contents&quot; False   (wo ^. woTOC)
      , ifNotDef &quot;reference-odt&quot;     Nothing (wo ^. woReferenceODT)
      , ifNotDef &quot;reference-docx&quot;    Nothing (wo ^. woReferenceDocX)
      ]
      where
        ifNotDef :: (ToJSON a, Eq a) =&gt; T.Text -&gt; a -&gt; a -&gt; [(T.Text, Value)]
        ifNotDef t d x | d == x    = []
                       | otherwise = [t .= x]

data FormatOptions :: Bool -&gt; Bool -&gt; Type where
    FormatOptions :: { _foFormat     :: Format r w
                     , _foReaderOpts :: HasIf r ReaderOptions
                     , _foWriterOpts :: HasIf w WriterOptions
                     }
               -&gt; FormatOptions r w
  deriving (Show, Generic)

makeLenses ''FormatOptions

instance (SingI r, SingI w) =&gt; Bi.Binary (FormatOptions r w)

instance (SingI r, SingI w) =&gt; Hashable (FormatOptions r w) where
    hashWithSalt s fo = s `hashWithSalt` (fo ^. foFormat)
                          `hashWithSalt` (fo ^. foReaderOpts)
                          `hashWithSalt` (fo ^. foWriterOpts)

-- instance (SingI r, SingI w) =&gt; FromJSON (FormatOptions r w) where

instance Bi.Binary (Writer FormatOptions) where
    get = do
      r &lt;- Bi.get @Bool
      withSomeSing @_ @Bool r $ \(sr :: Sing r) -&gt; withSingI sr $ do
        Writer @_ @r &lt;$&gt; Bi.get
    put = \case
      Writer (fo :: FormatOptions r 'True) -&gt; do
        Bi.put (fromSing (sing @_ @r))
        Bi.put fo

instance Hashable (Writer FormatOptions) where
    hashWithSalt s = \case
      Writer fo -&gt; s `hashWithSalt` fo

instance FromJSON (Writer FormatOptions) where
    parseJSON v = withOpts v &lt;|&gt; noOpts v
      where
        withOpts = withObject &quot;Writer FormatOptions&quot; $ \v' -&gt; do
          Writer ft &lt;- v' .: &quot;format&quot;
          ro &lt;- v' .:? &quot;opts&quot;
          wo &lt;- v' .:? &quot;opts&quot;
          return . Writer $
            FormatOptions ft (fromMaybe def ro) (fromMaybe def wo)
        noOpts t = parseJSON t &lt;&amp;&gt; \case
          Writer ft -&gt; Writer (FormatOptions ft def def)

instance ToJSON (Writer FormatOptions) where
    toJSON (Writer fo)
      | (fo ^. foReaderOpts == def) &amp;&amp; (fo ^. foWriterOpts == def) =
            toJSON (fo ^. foFormat)
      | otherwise =
            let rm = fo ^? foReaderOpts . _HasIf . re (_JSON @Value) . _Object
                wm = fo ^. foWriterOpts . _Has   . re (_JSON @Value) . _Object
            in  Object $ fold rm &lt;&gt; wm

instance Show (Writer FormatOptions) where
    showsPrec d (Writer fo) = showParen (d &gt; app_prec) $
        showString &quot;Writer &quot; . showsPrec (app_prec + 1) fo
      where
        app_prec = 10

fromReaderOptions :: ReaderOptions -&gt; P.ReaderOptions
fromReaderOptions _ = def

-- writerOptions :: Format r w -&gt; WriterOptions -&gt; P.WriterOptions
-- writerOptions _ _ = def

pdfFormat :: PDFType -&gt; Writer Format
pdfFormat = \case
    PTLaTeX   -&gt; Writer FLaTeX
    PTBeamer  -&gt; Writer $ FSlideShow SSBeamer
    PTConTeXt -&gt; Writer $ FConTeXt
    PTHTML5   -&gt; Writer $ FHTML True

formatReader
    :: Format 'True w
    -&gt; P.Reader
formatReader = fromMaybe (error &quot;invalid reader string?&quot;)
             . (`lookup` P.readers) . readerString

formatWriter
    :: Format r 'True
    -&gt; P.Writer
formatWriter = fromMaybe (error &quot;invalid writer string?&quot;)
             . (`lookup` P.writers) . writerString

readerString :: Format 'True w -&gt; String
readerString = \case
    FNative       -&gt; &quot;native&quot;
    FJSON         -&gt; &quot;json&quot;
    FMarkdown mt _ -&gt; case mt of
      MDPandoc    -&gt; &quot;markdown&quot;
      MDStrict    -&gt; &quot;markdown_strict&quot;
      MDPHP       -&gt; &quot;markdown_phpextra&quot;
      MDGithub    -&gt; &quot;markdown_github&quot;
      MDMulti     -&gt; &quot;markdown_mmd&quot;
      MDCommon    -&gt; &quot;commonmark&quot;
    FRST          -&gt; &quot;rst&quot;
    FMediaWiki    -&gt; &quot;mediawiki&quot;
    FDocBook _    -&gt; &quot;docbook&quot;
    FOPML         -&gt; &quot;opml&quot;
    FOrg          -&gt; &quot;org&quot;
    FTextile      -&gt; &quot;textile&quot;
    FHTML _       -&gt; &quot;html&quot;
    FLaTeX        -&gt; &quot;latex&quot;
    FHaddock      -&gt; &quot;haddock&quot;
    FTWiki        -&gt; &quot;twiki&quot;
    FDocX         -&gt; &quot;docx&quot;
    FODT          -&gt; &quot;odf&quot;
    FT2T          -&gt; &quot;t2t&quot;
    FEPub _       -&gt; &quot;epub&quot;
    FMkReadOnly f -&gt; readerString f         -- any way to indicate?

writerString :: Format r 'True -&gt; String
writerString = \case
    FNative        -&gt; &quot;native&quot;
    FJSON          -&gt; &quot;json&quot;
    FMarkdown mt _ -&gt; case mt of
      MDPandoc     -&gt; &quot;markdown&quot;
      MDStrict     -&gt; &quot;markdown_strict&quot;
      MDPHP        -&gt; &quot;markdown_phpextra&quot;
      MDGithub     -&gt; &quot;markdown_github&quot;
      MDMulti      -&gt; &quot;markdown_mmd&quot;
      MDCommon     -&gt; &quot;commonmark&quot;
    FRST           -&gt; &quot;rst&quot;
    FMediaWiki     -&gt; &quot;mediawiki&quot;
    FDocBook five  -&gt; &quot;docbook&quot; ++ if five then &quot;5&quot; else &quot;&quot;
    FOPML          -&gt; &quot;opml&quot;
    FOrg           -&gt; &quot;org&quot;
    FTextile       -&gt; &quot;textile&quot;
    FHTML five     -&gt; &quot;html&quot; ++ if five then &quot;5&quot; else &quot;&quot;
    FLaTeX         -&gt; &quot;latex&quot;
    FHaddock       -&gt; &quot;haddock&quot;
    FDocX          -&gt; &quot;docx&quot;
    FODT           -&gt; &quot;odf&quot;
    FEPub epv      -&gt; &quot;epub&quot; ++ case epv of P.EPUB2 -&gt; &quot;&quot;; P.EPUB3 -&gt; &quot;3&quot;
    FFictionBook2  -&gt; &quot;fb2&quot;
    FICML          -&gt; &quot;icml&quot;
    FSlideShow ss  -&gt; case ss of
      SSS5         -&gt; &quot;s5&quot;
      SSSlidy      -&gt; &quot;slidy&quot;
      SSSlideous   -&gt; &quot;slideous&quot;
      SSDZSlides   -&gt; &quot;dzslides&quot;
      SSRevealJS   -&gt; &quot;revealjs&quot;
      SSBeamer     -&gt; &quot;beamer&quot;
    FOpenDocument  -&gt; &quot;opendocument&quot;
    FConTeXt       -&gt; &quot;context&quot;
    FTexinfo       -&gt; &quot;texinfo&quot;
    FMan           -&gt; &quot;man&quot;
    FPlain         -&gt; &quot;plain&quot;
    FDokuWiki      -&gt; &quot;dokuwiki&quot;
    FASCIIDoc      -&gt; &quot;asciidoc&quot;
    FTEI           -&gt; &quot;tei&quot;
    -- TODO: is this right?
    FPDF t         -&gt; case pdfFormat t of Writer ft -&gt; writerString ft
    FZimWiki       -&gt; &quot;zimwiki&quot;
    FRTF           -&gt; &quot;rtf&quot;
    FMkWriteOnly f -&gt; writerString f            -- any way to indicate?

allFormats :: [SomeFormat]
allFormats = concat [ all'
                    , someFormat . FMkWriteOnly &lt;$&gt; mapMaybe rw all'
                    , someFormat . FMkReadOnly  &lt;$&gt; mapMaybe rw all'
                    ]
  where
    all' = concat
      [ [ someFormat FNative
        , someFormat FJSON
        ]
      , someFormat &lt;$&gt; (FMarkdown &lt;$&gt; [minBound .. maxBound] &lt;*&gt; [False, True])
      , [ someFormat FRST
        , someFormat FMediaWiki
        ]
      , someFormat . FDocBook &lt;$&gt; [minBound .. maxBound]
      , [ someFormat FOPML
        , someFormat FOrg
        , someFormat FTextile
        ]
      , someFormat . FHTML &lt;$&gt; [minBound .. maxBound]
      , [ someFormat FLaTeX
        , someFormat FHaddock
        , someFormat FTWiki
        , someFormat FDocX
        , someFormat FODT
        , someFormat FT2T
        ]
      , someFormat . FEPub &lt;$&gt; [P.EPUB2, P.EPUB3]
      , [ someFormat FFictionBook2
        , someFormat FICML
        ]
      , someFormat . FSlideShow &lt;$&gt; [minBound .. maxBound]
      , [ someFormat FOpenDocument
        , someFormat FConTeXt
        , someFormat FTexinfo
        , someFormat FMan
        , someFormat FPlain
        , someFormat FDokuWiki
        , someFormat FZimWiki
        , someFormat FASCIIDoc
        , someFormat FTEI
        ]
      , someFormat . FPDF &lt;$&gt; [minBound .. maxBound]
      , [ someFormat FRTF
        ]
      ]
    rw = filterSomeFormat STrue STrue

allWriters :: [Writer Format]
allWriters = mapMaybe go allFormats
  where
    go x = (Writer &lt;$&gt; filterSomeFormat SFalse STrue x)
       &lt;|&gt; (Writer &lt;$&gt; filterSomeFormat STrue  STrue x)


filterSomeFormat
    :: Sing r
    -&gt; Sing w
    -&gt; SomeFormat
    -&gt; Maybe (Format r w)
filterSomeFormat sr sw (SomeFormat sr' sw' ft) = do
    Refl &lt;- decideMaybe $ sr Si.%~ sr'
    Refl &lt;- decideMaybe $ sw Si.%~ sw'
    return ft
  where
    decideMaybe :: Si.Decision a -&gt; Maybe a
    decideMaybe = \case
      Si.Proved x    -&gt; Just x
      Si.Disproved _ -&gt; Nothing

parseSomeFormat :: MP.Parser SomeFormat
parseSomeFormat = do
    baseFormat &lt;- asum [ MP.try singleWord
                       , someFormat . ($ False) . FMarkdown &lt;$&gt; MP.try markdown
                       ]
    lhs     &lt;- asum [ MP.try $ True &lt;$ symbol &quot;lhs&quot;
                    , MP.try $ True &lt;$ symbol &quot;literate&quot;
                    , pure False
                    ]
    let lhsFormat = case baseFormat of
          SomeFormat sr sw ft -&gt; SomeFormat sr sw $
            case ft of
              FMarkdown t l -&gt; FMarkdown t (l || lhs)
              _             -&gt; ft
    modFlag &lt;- asum [ MP.try $ someFormat . FMkReadOnly  &lt;$ symbol &quot;readonly&quot;
                    , MP.try $ someFormat . FMkReadOnly  &lt;$ symbol &quot;ro&quot;
                    , MP.try $ someFormat . FMkReadOnly  &lt;$ symbol &quot;?&quot;
                    , MP.try $ someFormat . FMkWriteOnly &lt;$ symbol &quot;writeonly&quot;
                    , MP.try $ someFormat . FMkWriteOnly &lt;$ symbol &quot;wo&quot;
                    , MP.try $ someFormat . FMkWriteOnly &lt;$ symbol &quot;*&quot;
                    , pure $ someFormat
                    ]
    return $ case lhsFormat of
       SomeFormat STrue STrue ft -&gt; modFlag ft
       SomeFormat sr    sw    ft -&gt; SomeFormat sr sw ft
  where
    symbol = MPL.symbol' MP.space
    markdown :: MP.Parser MarkdownType
    markdown = do
      _ &lt;- MP.try (symbol &quot;markdown&quot;) &lt;|&gt; symbol &quot;md&quot;
      asum [ MP.try $ MDStrict &lt;$ symbol &quot;strict&quot;
           , MP.try $ MDPHP    &lt;$ symbol &quot;phpextra&quot;
           , MP.try $ MDPHP    &lt;$ symbol &quot;phpextras&quot;
           , MP.try $ MDPHP    &lt;$ symbol &quot;php&quot;
           , MP.try $ MDGithub &lt;$ symbol &quot;github&quot;
           , MP.try $ MDGithub &lt;$ symbol &quot;gh&quot;
           , MP.try $ MDMulti  &lt;$ symbol &quot;mmd&quot;
           , MP.try $ MDMulti  &lt;$ symbol &quot;multi&quot;
           , MP.try $ MDMulti  &lt;$ symbol &quot;multimarkdown&quot;
           , MP.try $ MDCommon &lt;$ symbol &quot;common&quot;
           , MP.try $ MDCommon &lt;$ symbol &quot;commonmark&quot;
           , pure MDPandoc
           ]
    singleWord :: MP.Parser SomeFormat
    singleWord = asum . flip M.mapWithKey singleWords $ \s ft -&gt; MP.try $
      ft &lt;$ symbol s
    singleWords :: M.Map String SomeFormat
    singleWords = M.fromList
      [ (&quot;native&quot;      , someFormat FNative                )
      , (&quot;haskell&quot;     , someFormat FNative                )
      , (&quot;json&quot;        , someFormat FJSON                  )
      , (&quot;common&quot;      , someFormat (FMarkdown MDCommon False))
      , (&quot;commonmark&quot;  , someFormat (FMarkdown MDCommon False)   )
      , (&quot;multimark&quot;   , someFormat (FMarkdown MDMulti False)   )
      , (&quot;multimarkdown&quot;, someFormat (FMarkdown MDMulti False)   )
      , (&quot;html&quot;        , someFormat (FHTML True)           )
      , (&quot;html4&quot;       , someFormat (FHTML False)          )
      , (&quot;html5&quot;       , someFormat (FHTML True)           )
      , (&quot;html-pdf&quot;    , someFormat (FPDF PTHTML5)         )
      , (&quot;html5-pdf&quot;   , someFormat (FPDF PTHTML5)         )
      , (&quot;epub&quot;        , someFormat (FEPub P.EPUB2)        )
      , (&quot;epub2&quot;       , someFormat (FEPub P.EPUB2)        )
      , (&quot;epub3&quot;       , someFormat (FEPub P.EPUB3)        )
      , (&quot;docbook&quot;     , someFormat (FDocBook False)       )
      , (&quot;db&quot;          , someFormat (FDocBook False)       )
      , (&quot;docbook5&quot;    , someFormat (FDocBook True)        )
      , (&quot;db5&quot;         , someFormat (FDocBook False)       )
      , (&quot;rst&quot;         , someFormat FRST                   )
      , (&quot;mediawiki&quot;   , someFormat FMediaWiki             )
      , (&quot;opml&quot;        , someFormat FOPML                  )
      , (&quot;org&quot;         , someFormat FOrg                   )
      , (&quot;textile&quot;     , someFormat FTextile               )
      , (&quot;latex&quot;       , someFormat FLaTeX                 )
      , (&quot;tex&quot;         , someFormat FLaTeX                 )
      , (&quot;pdf&quot;         , someFormat (FPDF PTLaTeX)         )
      , (&quot;latex-pdf&quot;   , someFormat (FPDF PTLaTeX)         )
      , (&quot;tex-pdf&quot;     , someFormat (FPDF PTLaTeX)         )
      , (&quot;haddock&quot;     , someFormat FHaddock               )
      , (&quot;twiki&quot;       , someFormat FTWiki                 )
      , (&quot;docx&quot;        , someFormat FDocX                  )
      , (&quot;doc&quot;         , someFormat FDocX                  )
      , (&quot;odt&quot;         , someFormat FODT                   )
      , (&quot;t2t&quot;         , someFormat FT2T                   )
      , (&quot;fb2&quot;         , someFormat FFictionBook2          )
      , (&quot;fb&quot;          , someFormat FFictionBook2          )
      , (&quot;fictionbook&quot; , someFormat FFictionBook2          )
      , (&quot;fictionbook2&quot;, someFormat FFictionBook2          )
      , (&quot;icml&quot;        , someFormat FICML                  )
      , (&quot;opendocument&quot;, someFormat FOpenDocument          )
      , (&quot;context&quot;     , someFormat FConTeXt               )
      , (&quot;context-pdf&quot; , someFormat (FPDF PTConTeXt)       )
      , (&quot;texinfo&quot;     , someFormat FTexinfo               )
      , (&quot;texi&quot;        , someFormat FTexinfo               )
      , (&quot;man&quot;         , someFormat FMan                   )
      , (&quot;plain&quot;       , someFormat FPlain                 )
      , (&quot;dokuwiki&quot;    , someFormat FDokuWiki              )
      , (&quot;doku&quot;        , someFormat FDokuWiki              )
      , (&quot;zimwiki&quot;     , someFormat FZimWiki               )
      , (&quot;zim&quot;         , someFormat FZimWiki               )
      , (&quot;asciidoc&quot;    , someFormat FASCIIDoc              )
      , (&quot;adoc&quot;        , someFormat FASCIIDoc              )
      , (&quot;tei&quot;         , someFormat FTEI                   )
      , (&quot;rtf&quot;         , someFormat FRTF                   )
      , (&quot;s5&quot;          , someFormat (FSlideShow SSS5)      )
      , (&quot;slidy&quot;       , someFormat (FSlideShow SSSlidy)   )
      , (&quot;slideous&quot;    , someFormat (FSlideShow SSSlideous))
      , (&quot;dz&quot;          , someFormat (FSlideShow SSDZSlides))
      , (&quot;dzslides&quot;    , someFormat (FSlideShow SSDZSlides))
      , (&quot;revealjs&quot;    , someFormat (FSlideShow SSRevealJS))
      , (&quot;reveal&quot;      , someFormat (FSlideShow SSRevealJS))
      , (&quot;beamer&quot;      , someFormat (FPDF PTBeamer)        )
      , (&quot;beamer-pdf&quot;  , someFormat (FPDF PTBeamer)        )
      , (&quot;beamer-latex&quot;, someFormat (FSlideShow SSBeamer)  )
      , (&quot;beamer-tex&quot;  , someFormat (FSlideShow SSBeamer)  )
      ]

instance FromJSON SomeFormat where
    parseJSON = withText &quot;SomeFormat&quot; $ \t -&gt;
      case MP.parse parseSomeFormat &quot;Value&quot; t of
        Left  e  -&gt; fail $ MP.parseErrorPretty e
        Right sf -&gt; return sf

unparseFormat :: Format r w -&gt; T.Text
unparseFormat = \case
    FNative       -&gt; &quot;native&quot;
    FJSON         -&gt; &quot;json&quot;
    FMarkdown mt t -&gt; (if t then (&lt;&gt; &quot; lhs&quot;) else id) $ case mt of
      MDPandoc -&gt; &quot;markdown&quot;
      MDStrict -&gt; &quot;markdown strict&quot;
      MDPHP    -&gt; &quot;markdown phpextra&quot;
      MDGithub -&gt; &quot;markdown github&quot;
      MDMulti  -&gt; &quot;multimarkdown&quot;
      MDCommon -&gt; &quot;commonmark&quot;
    FRST          -&gt; &quot;rst&quot;
    FMediaWiki    -&gt; &quot;mediawiki&quot;
    FDocBook t    -&gt; &quot;docbook&quot; &lt;&gt; if t then &quot;5&quot; else &quot;&quot;
    FOPML         -&gt; &quot;opml&quot;
    FOrg          -&gt; &quot;org&quot;
    FTextile      -&gt; &quot;textile&quot;
    FHTML t       -&gt; &quot;html&quot; &lt;&gt; if t then &quot;5&quot; else &quot;&quot;
    FLaTeX        -&gt; &quot;latex&quot;
    FHaddock      -&gt; &quot;haddock&quot;
    FTWiki        -&gt; &quot;twiki&quot;
    FDocX         -&gt; &quot;docx&quot;
    FODT          -&gt; &quot;odf&quot;
    FT2T          -&gt; &quot;t2t&quot;
    FEPub t       -&gt; &quot;epub&quot; &lt;&gt; case t of P.EPUB2 -&gt; &quot;&quot;; P.EPUB3 -&gt; &quot;e&quot;
    FFictionBook2 -&gt; &quot;fb2&quot;
    FICML         -&gt; &quot;icml&quot;
    FSlideShow ss -&gt; case ss of
      SSS5       -&gt; &quot;s5&quot;
      SSSlidy    -&gt; &quot;slidy&quot;
      SSSlideous -&gt; &quot;slideous&quot;
      SSDZSlides -&gt; &quot;dzslides&quot;
      SSRevealJS -&gt; &quot;revealjs&quot;
      SSBeamer   -&gt; &quot;beamer-latex&quot;
    FOpenDocument -&gt; &quot;opendocument&quot;
    FConTeXt      -&gt; &quot;context&quot;
    FTexinfo      -&gt; &quot;texinfo&quot;
    FMan          -&gt; &quot;man&quot;
    FPlain        -&gt; &quot;plain&quot;
    FDokuWiki     -&gt; &quot;dokuwiki&quot;
    FZimWiki      -&gt; &quot;zimwiki&quot;
    FASCIIDoc     -&gt; &quot;asciidoc&quot;
    FTEI          -&gt; &quot;tei&quot;
    FPDF t        -&gt; case t of
      PTLaTeX   -&gt; &quot;pdf&quot;
      PTBeamer  -&gt; &quot;beamer&quot;
      PTConTeXt -&gt; &quot;context-pdf&quot;
      PTHTML5   -&gt; &quot;html5-pdf&quot;
    FRTF           -&gt; &quot;rtf&quot;
    FMkWriteOnly t -&gt; unparseFormat t &lt;&gt; &quot;*&quot;
    FMkReadOnly  t -&gt; unparseFormat t &lt;&gt; &quot;?&quot;

instance ToJSON (Format r w) where
    toJSON = toJSON . unparseFormat

instance FromJSON (Writer Format) where
    parseJSON v = do
      SomeFormat sr sw ft &lt;- parseJSON v
      case sw of
        SFalse -&gt; fail $ printf &quot;A writable format is expected, but `%s` is %s.%s&quot;
                            (unparseFormat ft)
                            (case sr of STrue  -&gt; &quot;read-only&quot;
                                        SFalse -&gt; &quot;neither writable nor readable&quot;
                               :: String
                            )
                            (case ft of
                                 FMkReadOnly ft' -&gt; printf &quot; Did you intend to write `%s`?&quot;
                                                      (unparseFormat ft')
                                 _               -&gt; &quot;&quot;
                               :: String
                            )
        STrue  -&gt; withSingI sr $ return (Writer ft)

inferWriter :: String -&gt; Writer Format
inferWriter ext = case map toLower ext of
    &quot;&quot;         -&gt; Writer $ FMarkdown MDPandoc False
    &quot;tex&quot;      -&gt; Writer $ FLaTeX
    &quot;latex&quot;    -&gt; Writer $ FLaTeX
    &quot;ltx&quot;      -&gt; Writer $ FLaTeX
    &quot;context&quot;  -&gt; Writer $ FConTeXt
    &quot;ctx&quot;      -&gt; Writer $ FConTeXt
    &quot;rtf&quot;      -&gt; Writer FRTF
    &quot;rst&quot;      -&gt; Writer FRST
    &quot;s5&quot;       -&gt; Writer $ FSlideShow SSS5
    &quot;native&quot;   -&gt; Writer FNative
    &quot;json&quot;     -&gt; Writer FJSON
    &quot;txt&quot;      -&gt; Writer $ FMarkdown MDPandoc False
    &quot;text&quot;     -&gt; Writer $ FMarkdown MDPandoc False
    &quot;md&quot;       -&gt; Writer $ FMarkdown MDPandoc False
    &quot;markdown&quot; -&gt; Writer $ FMarkdown MDPandoc False
    &quot;textile&quot;  -&gt; Writer $ FTextile
    &quot;lhs&quot;      -&gt; Writer $ FMarkdown MDPandoc True
    &quot;texi&quot;     -&gt; Writer FTexinfo
    &quot;texinfo&quot;  -&gt; Writer FTexinfo
    &quot;db&quot;       -&gt; Writer $ FDocBook False
    &quot;db5&quot;      -&gt; Writer $ FDocBook True
    &quot;odt&quot;      -&gt; Writer FODT
    &quot;docx&quot;     -&gt; Writer FDocX
    &quot;epub&quot;     -&gt; Writer $ FEPub P.EPUB2
    &quot;epub2&quot;    -&gt; Writer $ FEPub P.EPUB2
    &quot;epub3&quot;    -&gt; Writer $ FEPub P.EPUB3
    &quot;org&quot;      -&gt; Writer FOrg
    &quot;asciidoc&quot; -&gt; Writer FASCIIDoc
    &quot;adoc&quot;     -&gt; Writer FASCIIDoc
    &quot;pdf&quot;      -&gt; Writer $ FPDF PTLaTeX
    &quot;fb2&quot;      -&gt; Writer FFictionBook2
    &quot;opml&quot;     -&gt; Writer FOPML
    &quot;icml&quot;     -&gt; Writer FICML
    &quot;tei.xml&quot;  -&gt; Writer FTEI
    &quot;tei&quot;      -&gt; Writer FTEI
    [y] | y `elem` ['1'..'9'] -&gt; Writer FMan
    &quot;html5&quot;     -&gt; Writer $ FHTML True
    _           -&gt; Writer $ FHTML False
</span></pre></body></html>